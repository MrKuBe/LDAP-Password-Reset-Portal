{% extends "base.html" %}

{% block title %}Reset Password{% endblock %}

{% block content %}
<div class="ui segment">
    <h2 class="ui header">
        <i class="key icon"></i>
        <div class="content">
            Reset User Password
            <div class="sub header">Enter user details to reset their password on your LDAP Environment</div>
        </div>
    </h2>

    <form class="ui form" method="POST" id="resetForm">
        {{ form.csrf_token }}
        <div class="field">
            <label>Target User Account Name</label>
            <div class="ui input">
                {{ form.user_samAccountName(placeholder="pmartin3") }}
            </div>
        </div>
        <div class="field required">
            <label>Employee ID (6 digits)</label>
            <div class="ui input">
                {{ form.employeeID(placeholder="001234", 
                    minlength="6", maxlength="6", pattern="[0-9]{6}",
                    title="Employee ID must be exactly 6 digits") }}
            </div>
        </div>
        <div class="field required">
            <label>Service Code (4 digits)</label>
            <div class="ui input">
                {{ form.serviceCode(placeholder="1234", 
                    minlength="4", maxlength="4", pattern="[0-9]{4}",
                    title="Service Code must be exactly 4 digits") }}
            </div>
        </div>

        <div class="ui divider"></div>

        <div class="ui warning message">
            <div class="header">Please Confirm</div>
            <p>Are you sure you want to reset the password for this user?</p>
        </div>

        <div class="ui buttons">
            <button class="ui button" type="button" onclick='window.location.href="{{ url_for("index") }}";'>Cancel</button>
            <div class="or"></div>
            {{ form.submit(class="ui positive button") }}
        </div>
    </form>

    <div class="ui info message">
        <div class="header">Important Information</div>
        <p>When you click on "Reset Password":</p>
        <ul class="list">
            <li><em data-emoji="shield"></em>Security checks will be performed on the target user (Employee ID, Service Code, VIP status)</li>
            <li><em data-emoji="e-mail"></em>The IT service will be notified by email</li>
            <li><em data-emoji="e-mail"></em>You will receive a confirmation email</li>
            <li><em data-emoji="mechanical_arm"></em>The request is automatically processed by a robot that runs 24/7 at regular intervals</li>
            <li><em data-emoji="alien"></em>To became an operator, contact our <a href="mailto:{{ config['itServiceEmail'] }}">IT Support</a></li>
        </ul>
    </div>

</div>

<script>
document.getElementById('resetForm').onsubmit = function(e) {
    const employeeID = document.querySelector('input[name="employeeID"]').value;
    const serviceCode = document.querySelector('input[name="serviceCode"]').value;
    
    if (employeeID.length !== 6) {
        alert('Employee ID must be exactly 6 digits');
        e.preventDefault();
        return false;
    }
    
    if (serviceCode.length !== 4) {
        alert('Service Code must be exactly 4 digits');
        e.preventDefault();
        return false;
    }
    
    if (!confirm('Do you really want to submit this password reset request?')) {
        e.preventDefault();
        return false;
    }
};
</script>
{% endblock %}